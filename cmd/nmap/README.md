# Nmap指纹扫描命令行工具

这是一个基于chainreactors/fingers项目中nmap引擎的并发指纹扫描命令行工具。

## 功能特性

- ✅ 支持CIDR网段和单个IP地址扫描
- ✅ 支持端口范围和单个端口扫描  
- ✅ 高并发扫描，可配置线程数
- ✅ 基于nmap指纹库进行服务识别
- ✅ 实时进度显示和统计信息
- ✅ 详细的扫描结果输出
- ✅ 可配置扫描深度级别

## 安装和编译

```bash
# 进入项目目录
cd cmd/nmap

# 编译
go build -o nmap-scanner .

# 或者直接运行
go run .
```

## 使用方法

### 基本用法

```bash
# 扫描单个IP的常见端口
./nmap-scanner -cidr 192.168.1.1 -port 22,80,443

# 扫描整个C段的HTTP服务
./nmap-scanner -cidr 192.168.1.0/24 -port 80,443,8080

# 扫描端口范围
./nmap-scanner -cidr 10.0.0.1-10.0.0.10 -port 1000-2000
```

### 高级用法

```bash
# 高并发扫描（200线程）
./nmap-scanner -cidr 192.168.1.0/24 -port 22,80,443,3389 -threads 200

# 设置超时时间（5秒）
./nmap-scanner -cidr 192.168.1.1 -port 80 -timeout 5

# 高深度扫描（使用更多探针）
./nmap-scanner -cidr 192.168.1.1 -port 80 -level 6

# 详细输出模式
./nmap-scanner -cidr 192.168.1.1 -port 80 -v

# 保存结果到文件
./nmap-scanner -cidr 192.168.1.0/24 -port 80,443 -o results.txt
```

## 参数说明

| 参数 | 说明 | 默认值 | 示例 |
|------|------|--------|------|
| `-cidr` | 目标CIDR范围或IP地址 | `127.0.0.1/32` | `192.168.1.0/24` |
| `-port` | 端口范围，支持逗号分隔和范围 | `22,80,443` | `80,443,1000-2000` |
| `-threads` | 并发线程数 | `100` | `200` |
| `-timeout` | 扫描超时时间（秒） | `3` | `5` |
| `-level` | 扫描深度级别（1-9） | `1` | `6` |
| `-v` | 详细输出模式 | `false` | `-v` |
| `-o` | 输出文件路径 | 无 | `results.txt` |

## 输出格式

### 扫描结果

```
✅ 192.168.1.1:80 -> nginx [nginx] v1.18.0 [http, web-server]
✅ 192.168.1.1:443 -> nginx [nginx] v1.18.0 [https, web-server, tls]
🔍 192.168.1.1:22 -> 已识别但无详细信息
🔓 192.168.1.1:3389 -> 端口开放
```

### 进度信息

```
📈 进度: 45.2% (1810/4000) | 速度: 156.3/s | 开放: 23 | 识别: 15
```

### 最终统计

```
✅ 扫描完成!
总耗时: 25.6s
扫描目标: 4000
开放端口: 23
识别服务: 15
扫描速度: 156.25 targets/sec
```

## 支持的端口格式

- 单个端口：`80`
- 多个端口：`80,443,8080`
- 端口范围：`1000-2000`
- 混合格式：`22,80,443,1000-2000,8080-8090`

## 支持的CIDR格式

- 单个IP：`192.168.1.1`
- CIDR网段：`192.168.1.0/24`
- 大网段：`10.0.0.0/16`

## 扫描级别说明

| 级别 | 描述 | 探针数量 | 适用场景 |
|------|------|----------|----------|
| 1 | 快速扫描 | 基础探针 | 快速发现常见服务 |
| 3 | 标准扫描 | 常用探针 | 平衡速度和准确性 |
| 6 | 深度扫描 | 大部分探针 | 详细服务识别 |
| 9 | 完全扫描 | 所有探针 | 最全面的识别 |

## 性能优化建议

1. **网络环境**：在良好的网络环境下使用更高的并发数
2. **目标规模**：大规模扫描时适当降低并发数避免网络拥塞
3. **超时设置**：根据网络延迟调整超时时间
4. **扫描级别**：根据需求选择合适的扫描级别

## 使用示例

### 内网资产发现

```bash
# 发现内网Web服务
./nmap-scanner -cidr 192.168.0.0/16 -port 80,443,8080,8443 -threads 300

# 发现内网常见服务
./nmap-scanner -cidr 10.0.0.0/8 -port 22,80,443,3389,1433,3306 -threads 200
```

### 单机服务识别

```bash
# 详细识别单台主机服务
./nmap-scanner -cidr 192.168.1.100 -port 1-65535 -level 6 -v
```

### 快速端口扫描

```bash
# 快速扫描常见端口
./nmap-scanner -cidr 192.168.1.0/24 -port 22,80,443,3389 -threads 500 -timeout 2
```

## 注意事项

1. 请确保有合法的扫描授权
2. 大规模扫描可能触发防火墙或IDS告警
3. 建议在测试环境中先验证扫描参数
4. 高并发扫描时注意系统资源使用情况

## 技术实现

- 基于chainreactors/fingers项目的nmap指纹引擎
- 使用goroutines实现高并发扫描
- 支持TCP连接和指纹匹配
- 实时统计和进度显示
- 内置CIDR和端口解析功能

## 故障排除

### 常见问题

1. **连接超时**：增加timeout参数值
2. **扫描速度慢**：增加threads参数值
3. **内存使用过高**：降低threads参数值
4. **识别率低**：增加level参数值

### 调试模式

```bash
# 启用详细输出查看更多信息
./nmap-scanner -cidr 192.168.1.1 -port 80 -v -level 6
```

